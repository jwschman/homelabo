prometheus:

  server:
    ## ClusterIP for ingress
    service:
      type: ClusterIP
    
    ## use internal ingress
    ingress:
      enabled: true
      ingressClassName: "internal"
      hosts:
        - external-prometheus.pawked.com

    ## Set up storage
    persistentVolume:
      enabled: true
      existingClaim: external-prometheus

    ## Resource limits
    resources:
      requests:
        memory: "2Gi"
        cpu: "500m"
      limits:
        memory: "4Gi"
        cpu: "1"

    ## Prometheus data retention period
    retention: "2d"

    ## Prometheus' data retention size
    retentionSize: "256MB"

  ## Everything else is run seperate
  grafana:
    enabled: false

  kube-state-metrics:
    enabled: false

  alertmanager:
    enabled: false

  prometheus-node-exporter:
    enabled: false

  prometheus-pushgateway:
    enabled: false

  serverFiles:
    prometheus.yml:
      scrape_configs:
        - job_name: 'federate'
          honor_labels: true
          metrics_path: '/federate'
          params:
            'match[]':
              - '{__name__="up"}'
              - '{__name__=~"node_cpu_seconds_total"}'
              - '{__name__=~"node_memory_MemAvailable_bytes"}'
              - '{__name__=~"node_memory_MemTotal_bytes"}'
              - '{__name__=~"node_time_seconds"}'
              - '{__name__=~"node_boot_time_seconds"}'
              - '{__name__=~"kubelet_running_pods"}'
              - '{__name__=~"node_filesystem_avail_bytes"}'
              - '{__name__=~"node_filesystem_size_bytes"}'
              - '{__name__=~"kube_pod_container_resource_limits"}'
              - '{__name__=~"kube_pod_container_resource_requests"}'
              - '{__name__=~"kube_node_status_condition"}'

          metric_relabel_configs:
            - source_labels: [instance]
              regex: '192\.168\.1\.250:.*'
              target_label: "instance"
              replacement: "control-plane"
              action: replace
            - source_labels: [instance]
              regex: '192\.168\.1\.251:.*'
              target_label: "instance"
              replacement: "worker-01"
              action: replace
            - source_labels: [instance]
              regex: '192\.168\.1\.252:.*'
              target_label: "instance"
              replacement: "worker-02"
              action: replace

          static_configs:
            - targets:
                - prometheus-stack-kube-prom-prometheus.monitoring.svc.cluster.local:9090